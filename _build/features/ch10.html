---
interact_link: content/features/ch10.ipynb
kernel_name: python3
kernel_path: content/features
has_widgets: false
title: |-
  Petrological thermodynamics of liquid and solid phases
pagenum: 7
prev_page:
  url: /features/ch09.html
next_page:
  url: /features/ch11.html
suffix: .ipynb
search: nbsp equi con component phase j solidus basalt parcoj frac equation left right ideal solution liquidus mf pres temperature pressure label eq system gpa delta sol melting composition function equilibrium begin end constant values olivine text ref partition given obar k temp melttempj solid melt table below along wt r p fraction align parameter three kg hydrous clapeyron linear above b refers eutectic curves where liq latentj rj equiv latent pure coefficients liquid lines figure model evolution bulk diagram computed soltemp solslope slope state coefficient sumk molarmassk exp small full phasemolarmass implicit value numerically equilib comp useful diagrams taken mantle

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Petrological thermodynamics of liquid and solid phases</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">mtri</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.matlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span><span class="p">,</span> <span class="n">fminbound</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-equilibrium-state">The equilibrium state<a class="anchor-link" href="#The-equilibrium-state"> </a></h2><p>The partition coefficient $\parco_j$ is given by
\begin{equation*}
  \label{eq:equilibrium_partitioning_nonlinear}
  \parco_j = \left[\frac{\sum_k\left(\obar{\con}_k/\molarmass_k\right)\parco_k}
             {\sum_k\left(\obar{\con}_k/\molarmass_k\right)}\right]
             \exp\left[\frac{\Delta\enthalpy_j^{m}}{R/\molarmass_j}
             \left(\frac{1}{\temp} -
             \frac{1}{\melttemp_j}\right)\right].\nonumber
\end{equation*}</p>
<p>In cases where, for example, we use a small set of fictitious <em>effective</em> components to approximate the full thermochemical system, the error that we make in taking $\phasemolarmass\liq/\phasemolarmass\sol \approx 1$ is acceptably small. With this approach, the partition coefficient $\parco_j$ becomes</p>
\begin{equation*}
  \label{eq:equilibrium_partitioning_simple}
  \parco_j(P,T) = \exp\left[\frac{\latent_j}{R_j}\left(\frac{1}{\temp} - \frac{1}{\melttemp_j(P)}\right)\right],
\end{equation*}<p>where $\latent_j\equiv-\Delta\enthalpy_j^m$ is the latent heat of melting for a solid composed of pure component $j$ and $R_j \equiv R/M_j$ is the modified gas constant.</p>
<p>Partition coefficients $\parco_j$ give an implicit equation for the equilibrium melt fraction $\equi\mf$ as</p>
\begin{equation*}
  \label{eq:equilibrium-melt-frac-implicit}
  \sum_{j=1}^N\frac{\obar{\con}_j \left[1-\parco_j(\temp,\pres)\right]}{\equi\mf + (1-\equi\mf)\parco_j(\temp,\pres)} = 0,
\end{equation*}<p>Once a value of $\equi\mf$ has been numerically obtained, it can be used to determine the phase composition</p>
\begin{align}
    \label{eq:equilib-phase-comp-liquid}
    \equi\con\liq_j &amp;= \frac{\obar{\con}_j}{\equi\mf +
    (1-\equi\mf)\parco_j},\\
    \label{eq:equilib-phase-comp-solid}
    \equi\con\sol_j &amp;= \frac{\obar{\con}_j}{\equi\mf/\parco_j +
                      (1-\equi\mf)}.
\end{align}<p>Table below shows parameter values for the two- and three-component ideal-solution systems. These values are useful for the demonstration of ideal-solution phase diagrams but should not be taken as an optimal calibration for the mantle.</p>
<table>
<thead><tr>
<th style="text-align:center">Name</th>
<th style="text-align:center">$j$</th>
<th style="text-align:center">&nbsp; &nbsp; &nbsp; &nbsp; $\melttemp_j(P=0)$ [$^\circ$C] &nbsp; &nbsp; &nbsp; &nbsp;</th>
<th style="text-align:center">$\clapeyron_j$ [GPa/K]</th>
<th style="text-align:center">$\latent_j$ [kJ/kg]</th>
<th style="text-align:center">$R_j$ [J/kg/K]</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">olivine</td>
<td style="text-align:center">1</td>
<td style="text-align:center">&nbsp; &nbsp; &nbsp; &nbsp; 1780 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td style="text-align:center">1/50</td>
<td style="text-align:center">600</td>
<td style="text-align:center">70</td>
</tr>
<tr>
<td style="text-align:center">basalt</td>
<td style="text-align:center">2</td>
<td style="text-align:center">&nbsp; &nbsp; &nbsp; &nbsp; 950 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td style="text-align:center">1/100</td>
<td style="text-align:center">450</td>
<td style="text-align:center">30</td>
</tr>
<tr>
<td style="text-align:center">hydrous basalt</td>
<td style="text-align:center">3</td>
<td style="text-align:center">&nbsp; &nbsp; &nbsp; &nbsp; 410 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td style="text-align:center">1/50</td>
<td style="text-align:center">330</td>
<td style="text-align:center">30</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Application-to-a-two-pseudo-component-system">Application to a two-pseudo-component system<a class="anchor-link" href="#Application-to-a-two-pseudo-component-system"> </a></h3><p>The change of this melting temperature with pressure is given by the Clausius-Clapeyron equation. For simplicity, 
we assume a constant value of $\clapeyron = \Delta\entropy/\Delta(1/\density)$, which gives</p>
\begin{equation}
  \label{eq:linear-solidus-relation}
  \temp^m_j(P) = \left.\temp^m_j\right\vert_{\pres=0} +
  \pres\clapeyron.
\end{equation}<p>This produces the straight lines in Figure below (a) under the assumption that the thermodynamic pressure mis lithostatic, i.e., $\Grad\pres=\density\gravity$.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">IdealSolutionParameters</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">clap</span><span class="p">,</span> <span class="n">Tm0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        par.L = latent heat in J/kg</span>
<span class="sd">        par.R = specific gas constant in J/kg/K</span>
<span class="sd">        par.Tm0 = melting point at P=0, K</span>
<span class="sd">        par.clap = Clapeyron slope in GPa/K</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>        <span class="c1"># J/kg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>        <span class="c1"># J/kg/K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clap</span> <span class="o">=</span> <span class="n">clap</span>  <span class="c1"># GPa/K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tm0</span> <span class="o">=</span> <span class="n">Tm0</span>    <span class="c1"># K</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ThetaStructure</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ts</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tf</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>  <span class="c1"># f the melt fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cl</span> <span class="o">=</span> <span class="n">cl</span>  <span class="c1"># liquid concentration vector (length n)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">cs</span>  <span class="c1"># solid concentration vector (length n)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ParCoef_IdealSolution</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    % Partition coefficient from ideal solution theory</span>
<span class="sd">    %    returns K, the partition coefficient</span>
<span class="sd">    %    inputs: T, temperature in Kelvin</span>
<span class="sd">    %            P, pressure in GPa</span>
<span class="sd">    %            par, parameter struct including</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Tm</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">Tm0</span> <span class="o">+</span> <span class="n">P</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">clap</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">L</span> <span class="o">/</span> <span class="n">par</span><span class="o">.</span><span class="n">R</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">T</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="n">Tm</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">EquilibriumResidual</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">PP</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">parco_func</span><span class="p">):</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">parco_func</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span> <span class="n">PP</span><span class="p">,</span> <span class="n">par_j</span><span class="p">)</span> <span class="k">for</span> <span class="n">par_j</span> <span class="ow">in</span> <span class="n">par</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cc_j</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">K_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ff</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">ff</span><span class="p">)</span> <span class="o">*</span> <span class="n">K_</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc_j</span><span class="p">,</span> <span class="n">K_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">K</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">EquilibriumState</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">cbar</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">parco_func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    % Partition coefficient from ideal solution theory</span>
<span class="sd">    %    returns Theta structure containing</span>
<span class="sd">    %       Theta.f = the melt fraction</span>
<span class="sd">    %       Theta.cl = liquid concentration vector (length n)</span>
<span class="sd">    %       Theta.cs = solid concentration vector (length n)</span>
<span class="sd">    %    inputs: n, number of components</span>
<span class="sd">    %            cbar = bulk composition (length n or n-1)</span>
<span class="sd">    %            T, temperature in Kelvin</span>
<span class="sd">    %            P, pressure in GPa</span>
<span class="sd">    %            par, array of parameter structs of length n including</span>
<span class="sd">    %               par.L = latent heat in J/kg</span>
<span class="sd">    %               par.R = specific gas constant in J/kg/K</span>
<span class="sd">    %               par.Tm0 = melting point at P=0, K</span>
<span class="sd">    %               par.clap = Clapeyron slope in GPa/K</span>
<span class="sd">    %            parco_func = function handle for computing partition coefficient</span>
<span class="sd">    %               with interface K = parco_func(T,P,par)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;n must be greater than 1&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">par</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">par</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;par array of structures must be length 1 or n&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">):</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">cbar</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">r</span><span class="p">,))</span> <span class="o">*</span> <span class="n">T</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">r</span><span class="p">,))</span> <span class="o">*</span> <span class="n">P</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;length(T)={len(T)} and length(P)={len(P)} must be equal if both are greater than 1&#39;</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">n</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;one dimension of the cbar array must have length n&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">cbar</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">n</span><span class="p">,):</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matlib</span><span class="o">.</span><span class="n">repmat</span><span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;cbar must have shape (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="n">Theta</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">T_i</span><span class="p">,</span> <span class="n">P_i</span><span class="p">,</span> <span class="n">cbar_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">cbar</span><span class="p">):</span>
        <span class="n">Theta_i</span> <span class="o">=</span> <span class="n">ThetaStructure</span><span class="p">()</span>
        <span class="n">Theta_i</span><span class="o">.</span><span class="n">Ts</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="k">lambda</span> <span class="n">T_</span><span class="p">:</span> <span class="n">EquilibriumResidual</span><span class="p">(</span><span class="n">T_</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">P_i</span><span class="p">,</span> <span class="n">cbar_i</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">),</span> <span class="n">T_i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Theta_i</span><span class="o">.</span><span class="n">Tl</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="k">lambda</span> <span class="n">T_</span><span class="p">:</span> <span class="n">EquilibriumResidual</span><span class="p">(</span><span class="n">T_</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">P_i</span><span class="p">,</span> <span class="n">cbar_i</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">),</span> 
                            <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">T_i</span><span class="o">+</span><span class="n">Theta_i</span><span class="o">.</span><span class="n">Ts</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">T_i</span> <span class="o">&lt;</span> <span class="n">Theta_i</span><span class="o">.</span><span class="n">Ts</span><span class="p">:</span>
            <span class="n">Theta_i</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="n">Theta_i</span><span class="o">.</span><span class="n">Tl</span> <span class="o">&lt;</span> <span class="n">T_i</span><span class="p">:</span>
            <span class="n">Theta_i</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Theta_i</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f_</span><span class="p">:</span> <span class="n">EquilibriumResidual</span><span class="p">(</span><span class="n">T_i</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">P_i</span><span class="p">,</span> <span class="n">cbar_i</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">),</span> 
                               <span class="mf">0.0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">parco_func</span><span class="p">(</span><span class="n">T_i</span><span class="p">,</span> <span class="n">P_i</span><span class="p">,</span> <span class="n">par_j</span><span class="p">)</span> <span class="k">for</span> <span class="n">par_j</span> <span class="ow">in</span> <span class="n">par</span><span class="p">])</span>

        <span class="n">Theta_i</span><span class="o">.</span><span class="n">cl</span> <span class="o">=</span> <span class="n">cbar_i</span> <span class="o">/</span> <span class="p">(</span><span class="n">Theta_i</span><span class="o">.</span><span class="n">f</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">Theta_i</span><span class="o">.</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">)</span>
        <span class="n">Theta_i</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">K</span> <span class="o">*</span> <span class="n">Theta_i</span><span class="o">.</span><span class="n">cl</span>
        <span class="n">Theta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Theta_i</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;inconsistent number of ThetaStructure&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Theta</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ideal-solution model of a two-component system of <em>olivine</em> ($j=1$) and <em>basalt</em> ($j=2$). Parameter values are given in table above. <strong>(a)</strong> Pure-component melting temperatures $\melttemp_j$ as a linear function of pressure. <strong>(b)</strong> Partition coefficients $\parco_j$ as a function of temperature at a constant pressure of 1 GPa. <strong>(c)</strong> Grey lines are the solidus and liquidus temperature as a function of the basalt fraction at a pressure of 1 GPa. The composition along the solidus curve refers to the solid phase; that along the liquidus curve refers to the liquid phase. Black lines indicate the compositional evolution of a closed system with bulk composition of 25% basalt component. <strong>(d)</strong> Equilibrium melt fraction as a function of temperature for a bulk composition of 25% basalt component at 1 GPa.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">par</span> <span class="o">=</span> <span class="p">[</span><span class="n">IdealSolutionParameters</span><span class="p">(</span><span class="mf">600e3</span><span class="p">,</span> <span class="mf">70.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">50.</span><span class="p">,</span> <span class="mf">1780.</span> <span class="o">+</span> <span class="mf">273.</span><span class="p">),</span> 
       <span class="n">IdealSolutionParameters</span><span class="p">(</span><span class="mf">450e3</span><span class="p">,</span> <span class="mf">30.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">950.</span> <span class="o">+</span> <span class="mf">273.</span><span class="p">)]</span>

<span class="c1"># thermodynamic state</span>
<span class="n">Pref</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">Pvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">Tref</span> <span class="o">=</span> <span class="mf">1350.</span> <span class="o">+</span> <span class="mf">273.</span>
<span class="n">Tvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1050.</span><span class="p">,</span> <span class="mf">1950.</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">+</span> <span class="mi">273</span>
<span class="n">cref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
<span class="n">cvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">cvar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">cvar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">axA</span><span class="p">,</span> <span class="n">axB</span><span class="p">),</span> <span class="p">(</span><span class="n">axC</span><span class="p">,</span> <span class="n">axD</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">18.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">))</span>

<span class="n">P</span>  <span class="o">=</span>  <span class="n">Pvar</span>
<span class="n">T</span>  <span class="o">=</span>  <span class="n">Tref</span>
<span class="n">c</span>  <span class="o">=</span>  <span class="n">cref</span>
<span class="n">Tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">par_i</span><span class="o">.</span><span class="n">Tm0</span> <span class="o">+</span> <span class="n">P</span><span class="o">/</span><span class="n">par_i</span><span class="o">.</span><span class="n">clap</span> <span class="k">for</span> <span class="n">par_i</span> <span class="ow">in</span> <span class="n">par</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Tm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T^\mathcal</span><span class="si">{S}</span><span class="s1">_1$&#39;</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Tm</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T^\mathcal</span><span class="si">{S}</span><span class="s1">_2$&#39;</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$P$, GPa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">900</span><span class="p">,</span> <span class="mi">2100</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">P</span>  <span class="o">=</span>  <span class="n">Pref</span>
<span class="n">T</span>  <span class="o">=</span>  <span class="n">Tvar</span>
<span class="n">c</span>  <span class="o">=</span>  <span class="n">cref</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ParCoef_IdealSolution</span><span class="p">(</span><span class="n">T_i</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par_j</span><span class="p">)</span> <span class="k">for</span> <span class="n">par_j</span> <span class="ow">in</span> <span class="n">par</span><span class="p">]</span> <span class="k">for</span> <span class="n">T_i</span> <span class="ow">in</span> <span class="n">T</span><span class="p">])</span>

<span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="n">K</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\check</span><span class="si">{K}</span><span class="s1">_1$&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="n">K</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\check</span><span class="si">{K}</span><span class="s1">_2$&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1050</span><span class="p">,</span> <span class="mi">1950</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{c}</span><span class="s1">^s_j/</span><span class="si">{c}</span><span class="s1">^\ell_j$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">Tvar</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">Pref</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">cref</span>
<span class="n">Theta</span> <span class="o">=</span> <span class="n">EquilibriumState</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">)</span>

<span class="n">axD</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tvar</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">f</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">],</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1200.</span><span class="p">,</span> <span class="mf">1750.</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">1300</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1700</span><span class="p">))</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\check</span><span class="si">{f}</span><span class="s1">$, wt. frac.&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1200.0</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(d)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">cl_hold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">cl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span>
<span class="n">cs_hold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span>
<span class="n">f_hold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">f</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span>
<span class="n">cl_hold</span><span class="p">[</span><span class="n">f_hold</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">cs_hold</span><span class="p">[</span><span class="mf">1.</span><span class="o">-</span><span class="n">f_hold</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">c</span>  <span class="o">=</span> <span class="n">cvar</span>
<span class="n">P</span>  <span class="o">=</span> <span class="n">Pref</span>
<span class="n">T</span>  <span class="o">=</span> <span class="n">Tref</span>
<span class="n">Theta2</span> <span class="o">=</span> <span class="n">EquilibriumState</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">)</span>

<span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Ts</span> <span class="o">-</span> <span class="mf">273.</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Theta2</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>
<span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tl</span> <span class="o">-</span> <span class="mf">273.</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Theta2</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;phase boundary&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>

<span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cl_hold</span><span class="p">,</span> <span class="n">Tvar</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\check</span><span class="si">{c}</span><span class="s1">^\ell_2$&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cs_hold</span><span class="p">,</span> <span class="n">Tvar</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\check</span><span class="si">{c}</span><span class="s1">^\ell_2$&#39;</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="si">{c}</span><span class="s1">^i_2$, wt. frac.&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="s1">&#39;$(c)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.22</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="s1">&#39;solid$+$liquid&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.72</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span><span class="s1">&#39;liquid&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">1150</span><span class="p">,</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/features/ch10_10_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Application-to-a-three-pseudo-component-system">Application to a three-pseudo-component system<a class="anchor-link" href="#Application-to-a-three-pseudo-component-system"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">par3</span> <span class="o">=</span> <span class="p">[</span><span class="n">IdealSolutionParameters</span><span class="p">(</span><span class="mf">600e3</span><span class="p">,</span> <span class="mf">70.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">50.</span><span class="p">,</span> <span class="mf">1780.</span> <span class="o">+</span> <span class="mf">273.</span><span class="p">),</span> 
        <span class="n">IdealSolutionParameters</span><span class="p">(</span><span class="mf">450e3</span><span class="p">,</span> <span class="mf">30.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">950.</span> <span class="o">+</span> <span class="mf">273.</span><span class="p">),</span> 
        <span class="n">IdealSolutionParameters</span><span class="p">(</span><span class="mf">330e3</span><span class="p">,</span> <span class="mf">30.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">50.</span><span class="p">,</span> <span class="mf">410.</span> <span class="o">+</span> <span class="mf">273.</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Pref</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">Pvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">Tref</span> <span class="o">=</span> <span class="mf">1350.</span> <span class="o">+</span> <span class="mf">273.</span>
<span class="n">Tvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">1700.</span> <span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">+</span> <span class="mf">273.</span>
<span class="n">cref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.248</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">npts</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">conc_water_in_pure_component</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="o">/</span><span class="n">cref</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Figures below plot the ideal-solution model of a three-component system of "olivine" ($j=1$), "basalt" ($j=2$) and "hydrous basalt" ($j=3$). Parameter values are given in table above. <strong>(a)</strong> Pure-component melting temperatures $\melttemp_j$ as a linear function of pressure. <strong>(b)</strong> Partition coefficients $\parco_j$ as a function of temperature at a constant pressure of 1 GPa. <strong>(d)</strong> Equilibrium melt fraction as a function of temperature for a bulk composition of 75 wt\% olivine component with and without 0.2 wt\% of hydrated basalt component at 1 GPa.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">axA</span><span class="p">,</span> <span class="n">axB</span><span class="p">,</span> <span class="n">axD</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">21.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">))</span>

<span class="n">P</span>  <span class="o">=</span>  <span class="n">Pvar</span>
<span class="n">T</span>  <span class="o">=</span>  <span class="n">Tref</span>
<span class="n">c</span>  <span class="o">=</span>  <span class="n">cref</span>
<span class="n">Tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">par_i</span><span class="o">.</span><span class="n">Tm0</span> <span class="o">+</span> <span class="n">P</span><span class="o">/</span><span class="n">par_i</span><span class="o">.</span><span class="n">clap</span> <span class="k">for</span> <span class="n">par_i</span> <span class="ow">in</span> <span class="n">par3</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Tm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T^\mathcal</span><span class="si">{S}</span><span class="s1">_1$&#39;</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Tm</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T^\mathcal</span><span class="si">{S}</span><span class="s1">_2$&#39;</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Tm</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="s1">&#39;-.k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T^\mathcal</span><span class="si">{S}</span><span class="s1">_3$&#39;</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$P$, GPa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">2100.</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">2000</span><span class="p">))</span>
<span class="n">axA</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2050.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">P</span>  <span class="o">=</span>  <span class="n">Pref</span>
<span class="n">T</span>  <span class="o">=</span>  <span class="n">Tvar</span>
<span class="n">c</span>  <span class="o">=</span>  <span class="n">cref</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ParCoef_IdealSolution</span><span class="p">(</span><span class="n">T_i</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par_j</span><span class="p">)</span> <span class="k">for</span> <span class="n">par_j</span> <span class="ow">in</span> <span class="n">par3</span><span class="p">]</span> <span class="k">for</span> <span class="n">T_i</span> <span class="ow">in</span> <span class="n">T</span><span class="p">])</span>

<span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="n">K</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\check</span><span class="si">{K}</span><span class="s1">_1$&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="n">K</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\check</span><span class="si">{K}</span><span class="s1">_2$&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="n">K</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;-.k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\check</span><span class="si">{K}</span><span class="s1">_3$&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">1700.</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{c}</span><span class="s1">^s_j/</span><span class="si">{c}</span><span class="s1">^\ell_j$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">((</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e0</span><span class="p">))</span>
<span class="n">axB</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1010.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">Tvar</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">Pref</span>
<span class="n">cwet</span> <span class="o">=</span> <span class="n">cref</span>
<span class="n">Theta_wet</span> <span class="o">=</span> <span class="n">EquilibriumState</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par3</span><span class="p">),</span> <span class="n">cwet</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par3</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">)</span>

<span class="n">cdry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
<span class="n">Theta_dry</span> <span class="o">=</span> <span class="n">EquilibriumState</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par3</span><span class="p">),</span> <span class="n">cdry</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par3</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">)</span>

<span class="n">axD</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tvar</span> <span class="o">-</span> <span class="mf">273.</span><span class="p">,</span> <span class="p">[</span><span class="n">t_wet</span><span class="o">.</span><span class="n">f</span> <span class="k">for</span> <span class="n">t_wet</span> <span class="ow">in</span> <span class="n">Theta_wet</span><span class="p">],</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;wet&#39;</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tvar</span> <span class="o">-</span> <span class="mf">273.</span><span class="p">,</span> <span class="p">[</span><span class="n">t_dry</span><span class="o">.</span><span class="n">f</span> <span class="k">for</span> <span class="n">t_dry</span> <span class="ow">in</span> <span class="n">Theta_dry</span><span class="p">],</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;dry&#39;</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\check</span><span class="si">{f}</span><span class="s1">$, wt. frac.&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">1500.</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
<span class="n">axD</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1450.</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span><span class="s1">&#39;(d)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axD</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">cl_hold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">cl</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta_wet</span><span class="p">])</span>
<span class="n">cs_hold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">cs</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta_wet</span><span class="p">])</span>
<span class="n">f_hold</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">f</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta_wet</span><span class="p">])</span>
<span class="n">cl_hold</span><span class="p">[</span><span class="n">f_hold</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">cs_hold</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">f_hold</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/features/ch10_16_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Figure below plot the ideal-solution model of a three-component system of "olivine" ($j=1$), "basalt" ($j=2$) and "hydrous basalt" ($j=3$). Parameter values are given in table above. <strong>(c)</strong> Surfaces are the solidus and liquidus temperature through the full, 3-component space at a pressure of 1 GPa. The composition along the solidus surface refers to the solid phase; that along the liquidus surface refers to the liquid phase. The compositional evolution of the melt for a closed system with 75 wt\% olivine and 0.2 wt\% hydrous basalt is shown by the solid line.  It starts at the triangle and progresses toward the circle with increasing $\temp$ and $\equi\mf$.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">C3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<span class="n">C2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<span class="p">[</span><span class="n">C2</span><span class="p">,</span><span class="n">C3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">C2</span><span class="p">,</span><span class="n">C3</span><span class="p">)</span>
<span class="n">C2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">C2</span><span class="p">,</span> <span class="n">npts</span><span class="o">*</span><span class="n">npts</span><span class="p">)</span>
<span class="n">C3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">C3</span><span class="p">,</span> <span class="n">npts</span><span class="o">*</span><span class="n">npts</span><span class="p">)</span>
<span class="n">C1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">C2</span><span class="o">-</span><span class="n">C3</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npts</span><span class="o">*</span><span class="n">npts</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">C</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">C1</span>
<span class="n">C</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">C2</span>
<span class="n">C</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C3</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">Pref</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">Tref</span>
<span class="n">Theta</span> <span class="o">=</span> <span class="n">EquilibriumState</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par3</span><span class="p">),</span> <span class="n">C</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par3</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">);</span>
<span class="n">Tsol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">Ts</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span>
<span class="n">Tliq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">Tl</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span>
<span class="n">Tsol</span><span class="p">[</span><span class="n">C</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">Tliq</span><span class="p">[</span><span class="n">C</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">C</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/fredericoteixeira/Applications/anaconda3/lib/python3.7/site-packages/scipy/optimize/minpack.py:162: RuntimeWarning: The iteration is not making good progress, as measured by the 
  improvement from the last ten iterations.
  warnings.warn(msg, RuntimeWarning)
/Users/fredericoteixeira/Applications/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:10: RuntimeWarning: overflow encountered in exp
  # Remove the CWD from sys.path while we load stuff.
/Users/fredericoteixeira/Applications/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:3: RuntimeWarning: invalid value encountered in double_scalars
  This is separate from the ipykernel package so we can avoid doing imports until
/Users/fredericoteixeira/Applications/anaconda3/lib/python3.7/site-packages/scipy/optimize/minpack.py:162: RuntimeWarning: The iteration is not making good progress, as measured by the 
  improvement from the last five Jacobian evaluations.
  warnings.warn(msg, RuntimeWarning)
/Users/fredericoteixeira/Applications/anaconda3/lib/python3.7/site-packages/scipy/optimize/minpack.py:162: RuntimeWarning: The number of calls to function has reached maxfev = 400.
  warnings.warn(msg, RuntimeWarning)
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">terncoords</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">):</span>
    <span class="n">csum</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">+</span> <span class="n">c3</span>
    <span class="n">c1</span>  <span class="o">=</span> <span class="n">c1</span><span class="o">/</span><span class="n">csum</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">/</span><span class="n">csum</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">c3</span><span class="o">/</span><span class="n">csum</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">y</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">terncoords</span><span class="p">(</span><span class="n">C2</span><span class="p">,</span> <span class="n">C3</span><span class="p">,</span> <span class="n">C1</span><span class="p">)</span>
<span class="n">triangXY</span> <span class="o">=</span> <span class="n">mtri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axC</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">})</span>

<span class="n">axC</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">triangXY</span><span class="p">,</span> <span class="n">Tsol</span><span class="p">)</span>
<span class="n">surf</span> <span class="o">=</span> <span class="n">axC</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">triangXY</span><span class="p">,</span> <span class="n">Tliq</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">terncoords</span><span class="p">(</span><span class="n">cl_hold</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cl_hold</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">cl_hold</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">grids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grids</span> <span class="o">=</span> <span class="n">grids</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">terncoords</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">grids</span><span class="p">,</span> <span class="n">grids</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grids</span><span class="p">))</span>
<span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">terncoords</span><span class="p">(</span><span class="n">grids</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grids</span><span class="p">),</span> <span class="mi">100</span><span class="o">-</span><span class="n">grids</span><span class="p">)</span>
<span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">terncoords</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grids</span><span class="p">),</span> <span class="mi">100</span><span class="o">-</span><span class="n">grids</span><span class="p">,</span> <span class="n">grids</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">m</span><span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x2</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y2</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x3</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">y2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y3</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">y3</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y1</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;$</span><span class="si">{c}</span><span class="s1">_3^i$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;$</span><span class="si">{c}</span><span class="s1">_2^i$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.13</span><span class="p">,</span><span class="o">-</span><span class="mf">0.030</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;$</span><span class="si">{c}</span><span class="s1">_1^i$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">grids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
<span class="k">for</span> <span class="n">x3_</span><span class="p">,</span> <span class="n">y3_</span><span class="p">,</span> <span class="n">l_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">y3</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x3_</span><span class="o">+</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">y3_</span><span class="o">-</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">l_</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x2_</span><span class="p">,</span> <span class="n">y2_</span><span class="p">,</span> <span class="n">l_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">y2</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x2_</span><span class="o">+</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">y2_</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">l_</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x1_</span><span class="p">,</span> <span class="n">y1_</span><span class="p">,</span> <span class="n">l_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">y1</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">axC</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x1_</span><span class="o">-</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">y1_</span><span class="o">+</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">l_</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    
<span class="n">axC</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(())</span>
<span class="n">axC</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(())</span>
<span class="n">axC</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">(())</span>

<span class="n">ticks_</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">(</span><span class="n">ticks_</span><span class="p">))</span>
<span class="n">cticks_</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Tliq</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">Tliq</span><span class="p">))</span><span class="o">*</span><span class="n">s</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">Tliq</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ticks_</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">((</span><span class="n">cticks_</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/features/ch10_21_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Approaching-the-eutectic-phase-diagram">Approaching the eutectic phase diagram<a class="anchor-link" href="#Approaching-the-eutectic-phase-diagram"> </a></h3><p>A eutectic phase diagram compared with ideal-solution phase loops for different values of $R_2$. Other ideal-solution 
parameters are $R_1=60$ J/kg/K, $\latent_1=\latent_2=500$ kJ/kg. <strong>(a)</strong> Solidus and liquidus curves computed with ideal solution theory compared with the eutectic solidus and liquidus. <strong>(b)</strong> Isobaric melting curves computed based on the phase loops and the eutectic.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">liquidusQuadratic</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">L</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">cp</span><span class="o">*</span><span class="p">(</span><span class="n">T0</span><span class="o">-</span><span class="n">Te</span><span class="p">)</span><span class="o">-</span><span class="n">H</span>
    <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">C</span><span class="o">*</span><span class="n">cp</span><span class="o">*</span><span class="p">(</span><span class="n">T0</span><span class="o">-</span><span class="n">Te</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">equilibriumEutectic</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">cp</span><span class="p">):</span>
    <span class="n">He_low</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">He_high</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span> <span class="k">if</span> <span class="n">Hj</span> <span class="o">&lt;=</span> <span class="n">He_low</span> <span class="k">else</span> 
                  <span class="n">Hj</span><span class="o">/</span><span class="n">L</span> <span class="k">if</span> <span class="n">Hj</span> <span class="o">&lt;=</span> <span class="n">He_high</span> <span class="k">else</span> 
                  <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">liquidusQuadratic</span><span class="p">(</span><span class="n">Hj</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">L</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">Hj</span> <span class="ow">in</span> <span class="n">H</span><span class="p">])</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Te</span> <span class="o">+</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span><span class="o">/</span><span class="n">cp</span>
    <span class="k">return</span> <span class="n">T</span><span class="p">,</span> <span class="n">f</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pseudoEutecticSolidus</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">T0</span> <span class="o">+</span> <span class="p">(</span><span class="n">Te</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">C</span><span class="o">/</span><span class="n">gamma</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pseudoEutecticLiquidus</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">T0</span> <span class="o">+</span> <span class="p">(</span><span class="n">Te</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">*</span><span class="n">C</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">equilibriumPseudoEutectic</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="n">pES</span> <span class="o">=</span> <span class="n">pseudoEutecticSolidus</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">pEL</span> <span class="o">=</span> <span class="n">pseudoEutecticLiquidus</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">Tj</span> <span class="o">&lt;</span> <span class="n">pES</span> <span class="k">else</span>
                   <span class="n">C</span> <span class="k">if</span> <span class="n">Tj</span> <span class="o">&gt;</span> <span class="n">pEL</span> <span class="k">else</span>
                   <span class="p">(</span><span class="n">Tj</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Te</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span> <span class="k">for</span> <span class="n">Tj</span> <span class="ow">in</span> <span class="n">T</span><span class="p">])</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">C</span> <span class="k">if</span> <span class="n">Tj</span> <span class="o">&lt;</span> <span class="n">pES</span> <span class="k">else</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">Tj</span> <span class="o">&gt;</span> <span class="n">pEL</span> <span class="k">else</span>
                   <span class="o">-</span><span class="n">gamma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cl_j</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="p">)))</span> <span class="k">for</span> <span class="n">Tj</span><span class="p">,</span> <span class="n">cl_j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">cl</span><span class="p">)])</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span> <span class="k">if</span> <span class="n">Tj</span> <span class="o">&lt;</span> <span class="n">pES</span> <span class="k">else</span>
                  <span class="mf">1.0</span> <span class="k">if</span> <span class="n">Tj</span> <span class="o">&gt;</span> <span class="n">pEL</span> <span class="k">else</span>
                  <span class="p">(</span><span class="n">C</span><span class="o">-</span><span class="n">cs_j</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cl_j</span> <span class="o">-</span> <span class="n">cs_j</span><span class="p">)</span> <span class="k">for</span> <span class="n">Tj</span><span class="p">,</span> <span class="n">cl_j</span><span class="p">,</span> <span class="n">cs_j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">cs</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">f</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">npts</span> <span class="o">=</span>  <span class="mi">500</span>
<span class="n">Tref</span> <span class="o">=</span> <span class="mi">1350</span>
<span class="n">Tvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">950</span><span class="p">,</span> <span class="mi">1900</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
<span class="n">cref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
<span class="n">Pref</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">P</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">T0</span>   <span class="o">=</span>  <span class="mi">2000</span>
<span class="n">Te</span>   <span class="o">=</span>  <span class="mi">1000</span>
<span class="n">L</span>    <span class="o">=</span>  <span class="mf">500e3</span>

<span class="n">gamma_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plotstyle</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;:k&#39;</span><span class="p">,</span> <span class="s1">&#39;-.k&#39;</span><span class="p">,</span> <span class="s1">&#39;--k&#39;</span><span class="p">]</span>
<span class="n">cp</span> <span class="o">=</span> <span class="mi">1200</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="p">,</span> <span class="n">L</span> <span class="o">+</span> <span class="n">cp</span><span class="o">*</span><span class="p">(</span><span class="n">T0</span><span class="o">-</span><span class="n">Te</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">axA</span><span class="p">,</span> <span class="n">axB</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">18.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">))</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">Te</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T0</span><span class="o">-</span><span class="n">Te</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">X</span>

<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">Te</span><span class="p">,</span> <span class="n">T0</span><span class="p">],</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">pltstyle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gamma_arr</span><span class="p">,</span> <span class="n">plotstyle</span><span class="p">):</span>
    <span class="n">Ts</span> <span class="o">=</span> <span class="n">pseudoEutecticSolidus</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">pltstyle</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">axA</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="si">{c}</span><span class="s1">^i_2/c^E_2$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">900</span><span class="p">,</span> <span class="mi">2000</span><span class="p">))</span>
<span class="n">axA</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1990.</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">TE</span><span class="p">,</span> <span class="n">fE</span> <span class="o">=</span> <span class="n">equilibriumEutectic</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">cref</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">cp</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Tvar</span><span class="p">,</span> <span class="n">Te</span><span class="p">)))</span>
<span class="n">plots</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">pltstyle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gamma_arr</span><span class="p">,</span> <span class="n">plotstyle</span><span class="p">):</span>
    <span class="n">theta_f</span> <span class="o">=</span> <span class="n">equilibriumPseudoEutectic</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">cref</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">T0</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">theta_f</span><span class="p">,</span> <span class="n">pltstyle</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$\gamma=$</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span>
<span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">TE</span><span class="p">,</span> <span class="n">fE</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;eutectic&#39;</span><span class="p">)</span>

<span class="n">axB</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">950</span><span class="p">,</span> <span class="mi">1900</span><span class="p">])</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\check</span><span class="si">{f}</span><span class="s1">$, wt. frac.&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">980</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span><span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
           <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">),</span>  <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/features/ch10_29_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Linearising-the-two-component-phase-diagram">Linearising the two-component phase diagram<a class="anchor-link" href="#Linearising-the-two-component-phase-diagram"> </a></h3><p>Phase diagrams constructed with ideal solution theory provide a useful basis for developing the melting relations required for magma/mantle dynamics. Their nonlinearity, however, precludes a use in analytical calculations; instead they must be handled numerically. It is therefore important to formulate an approximation in which the equilibrium state is computed analytically.</p>
<p>For linear variations in pressure and composition, we can write</p>
<p>\begin{align}
    \label{eq:col-twocomp-pd-solidus}
    \soltemp &amp;= \soltemp_\text{ref} + (\pres-\pres_\text{ref})/\clapeyron  +
               \solslope\left(\equi\con\sol - \equi\con\sol_{\text{ref}}\right),\\
  \label{eq:col-twocomp-pd-deltac}
    \equi\con\liq &amp;= \equi\con\sol - \Delta\equi\con,
  \end{align}</p>
<p>where $\solslope$ is the constant slope of the solidus with concentration in the two component space and $\soltemp_\text{ref}$ is a reference temperature at $\pres=\pres_\text{ref}$ and $\equi\con\sol=\equi\con\sol_\text{ref}$.  Also, $\Delta\equi\con \equiv \equi\con\sol - \equi\con\liq$ is the concentration difference between the solidus and the liquidus.  If $\Delta\equi\con$ is taken to be a constant then the liquidus slope $\liqslope$ and the solidus slope $\solslope$ are equal.</p>
<p>Figure below plots a comparison of a two-component, ideal-solution phase loop with a linearised solidus and liquidus at 1 GPa. The phase loop uses the parameters from the Table above. <strong>(a)</strong> Solidus and liquidus curves.  Evolution of an initially unmolten rock with 25 wt% basaltic component for increasing temperature, along the linearised phase boundaries. <strong>(b)</strong> Isobaric melting curves.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">SolLiqTemperature</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">Cref</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">Tref</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Tref</span> <span class="o">+</span> <span class="n">M</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="o">-</span><span class="n">Cref</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">SolLiqComposition</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Tref</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">Cref</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Cref</span> <span class="o">+</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">Tref</span><span class="p">)</span><span class="o">/</span><span class="n">M</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">MeltFraction</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">ML</span><span class="p">,</span> <span class="n">MS</span><span class="p">,</span> <span class="n">LCref</span><span class="p">,</span> <span class="n">SCref</span><span class="p">,</span> <span class="n">Tref</span><span class="p">):</span>
    <span class="n">TS</span> <span class="o">=</span> <span class="n">SolLiqTemperature</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">SCref</span><span class="p">,</span> <span class="n">MS</span><span class="p">,</span> <span class="n">Tref</span><span class="p">)</span>
    <span class="n">TL</span> <span class="o">=</span> <span class="n">SolLiqTemperature</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">LCref</span><span class="p">,</span> <span class="n">ML</span><span class="p">,</span> <span class="n">Tref</span><span class="p">)</span>
    <span class="n">Cs</span> <span class="o">=</span> <span class="n">SolLiqComposition</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Tref</span><span class="p">,</span> <span class="n">MS</span><span class="p">,</span> <span class="n">SCref</span><span class="p">)</span>
    <span class="n">Cl</span> <span class="o">=</span> <span class="n">SolLiqComposition</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Tref</span><span class="p">,</span> <span class="n">ML</span><span class="p">,</span> <span class="n">LCref</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">Cs</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Cl</span> <span class="o">-</span> <span class="n">Cs</span><span class="p">)</span>
    <span class="n">F</span><span class="p">[</span><span class="n">T</span> <span class="o">&lt;=</span> <span class="n">TS</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">F</span><span class="p">[</span><span class="n">T</span> <span class="o">&gt;=</span> <span class="n">TL</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">Cs</span><span class="p">[</span><span class="n">T</span> <span class="o">&lt;</span> <span class="n">TS</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span>
    <span class="n">Cl</span><span class="p">[</span><span class="n">T</span> <span class="o">&lt;</span> <span class="n">TS</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">F</span><span class="p">,</span> <span class="n">Cs</span><span class="p">,</span> <span class="n">Cl</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">par_lin</span> <span class="o">=</span> <span class="p">[</span><span class="n">IdealSolutionParameters</span><span class="p">(</span><span class="mf">600e3</span><span class="p">,</span> <span class="mf">70.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">1780.</span> <span class="o">+</span> <span class="mf">273.</span><span class="p">),</span> 
           <span class="n">IdealSolutionParameters</span><span class="p">(</span><span class="mf">450e3</span><span class="p">,</span> <span class="mf">30.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">112.</span><span class="p">,</span> <span class="mf">950.</span> <span class="o">+</span> <span class="mf">273.</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Pref</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">Pvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">Tref</span> <span class="o">=</span> <span class="mf">1350.</span> <span class="o">+</span> <span class="mf">273.</span>
<span class="n">Tvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">900.</span><span class="p">,</span> <span class="mf">1350.</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span> <span class="o">+</span> <span class="mf">273.</span>
<span class="n">cref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
<span class="n">cvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">300</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="n">cvar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">cvar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">axA</span><span class="p">,</span> <span class="n">axB</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">18.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">))</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">cvar</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">Tref</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">Pref</span>
<span class="n">Theta</span> <span class="o">=</span> <span class="n">EquilibriumState</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par_lin</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par_lin</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">)</span>

<span class="n">Cint</span> <span class="o">=</span> <span class="n">cref</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.999</span><span class="p">,</span> <span class="mf">1.001</span><span class="p">])</span>
<span class="n">f_Tint</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">Ts</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span> <span class="o">-</span> <span class="mf">273.</span><span class="p">)</span>
<span class="n">Tint</span> <span class="o">=</span> <span class="n">f_Tint</span><span class="p">(</span><span class="n">Cint</span><span class="p">)</span>
<span class="n">MS</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Tint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">Cint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Cint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">Tref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Tint</span><span class="p">)</span>
<span class="n">f_Cint</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">Tl</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span> <span class="o">-</span> <span class="mi">273</span><span class="p">,</span> <span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Cint</span> <span class="o">=</span> <span class="n">f_Cint</span><span class="p">(</span><span class="n">Tint</span><span class="p">)</span>
<span class="n">ML</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Tint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">Cint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Cint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">Cref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Cint</span><span class="p">)</span>
<span class="n">F</span><span class="p">,</span> <span class="n">Cs</span><span class="p">,</span> <span class="n">Cl</span> <span class="o">=</span> <span class="n">MeltFraction</span><span class="p">(</span><span class="n">Tvar</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="n">cref</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ML</span><span class="p">,</span> <span class="n">MS</span><span class="p">,</span> <span class="n">Cref</span><span class="p">,</span> <span class="n">cref</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tref</span><span class="p">)</span>

<span class="n">plots</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">Ts</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">Tl</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">])</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]))</span>
<span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">SolLiqTemperature</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Cref</span><span class="p">,</span> <span class="n">ML</span><span class="p">,</span> <span class="n">Tref</span><span class="p">),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">SolLiqTemperature</span><span class="p">(</span><span class="n">c</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cref</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MS</span><span class="p">,</span> <span class="n">Tref</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Cs</span><span class="p">,</span> <span class="n">Tvar</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Cl</span><span class="p">,</span> <span class="n">Tvar</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">axA</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="si">{c}</span><span class="s1">^i_2$, wt. frac.&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">axA</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">])</span>
<span class="n">axA</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axA</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1010.</span><span class="p">,</span> <span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;$T^\mathcal</span><span class="si">{S}</span><span class="s1">, T^\mathcal</span><span class="si">{L}</span><span class="s1">$ (ideal soln.)&#39;</span><span class="p">,</span> <span class="s1">&#39;$T^\mathcal</span><span class="si">{S}</span><span class="s1">,T^\mathcal</span><span class="si">{L}</span><span class="s1">$ (linear)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;$\check</span><span class="si">{c}</span><span class="s1">^s_2(T),\check</span><span class="si">{c}</span><span class="s1">^\ell_2(T)$, (linear)&#39;</span><span class="p">]</span>
<span class="n">axA</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">Tvar</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">Pref</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">cref</span>
<span class="n">Theta</span> <span class="o">=</span> <span class="n">EquilibriumState</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par_lin</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">par_lin</span><span class="p">,</span> <span class="n">ParCoef_IdealSolution</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">th</span><span class="o">.</span><span class="n">f</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">Theta</span><span class="p">]),</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ideal soln.&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$T$, $^\circ$C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">1350</span><span class="p">])</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">1250</span><span class="p">,</span> <span class="mi">1300</span><span class="p">,</span> <span class="mi">1350</span><span class="p">))</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\check</span><span class="si">{f}</span><span class="s1">$, wt. frac.&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
<span class="n">axB</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1340.01</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axB</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/features/ch10_36_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

 


    </main>
    