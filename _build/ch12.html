---
interact_link: content/ch12.ipynb
kernel_name: python3
kernel_path: content
has_widgets: false
title: |-
  Reactive flow and the emergence of melt channels
pagenum: 9
prev_page:
  url: /ch11.html
next_page:
  url: /ch13.html
suffix: .ipynb
search: chapter reactive flow emergence melt channels linearised stability analysis base state growth rate perturbations large damkohler limit modified problem its analytical solution application mantle

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"></div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Chapter-12---Reactive-flow-and-the-emergence-of-melt-channels">Chapter 12 - Reactive flow and the emergence of melt channels<a class="anchor-link" href="#Chapter-12---Reactive-flow-and-the-emergence-of-melt-channels"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">cycler</span> <span class="kn">import</span> <span class="n">cycler</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Linearised-stability-analysis">Linearised stability analysis<a class="anchor-link" href="#Linearised-stability-analysis"> </a></h2><h3 id="The-base-state">The base state<a class="anchor-link" href="#The-base-state"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">zoom</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">8.0</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">,</span> <span class="mf">5.2</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">G</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
<span class="n">S</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">([</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">S</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">G</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">M</span><span class="p">],</span> <span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="mf">1.</span><span class="o">+</span><span class="n">G</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">G</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">M</span><span class="p">])</span>
<span class="nb">cmp</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">chi</span> <span class="o">+</span> <span class="n">G</span><span class="p">)</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">([</span><span class="n">chij</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">S</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">cmpj</span><span class="p">)</span> <span class="k">for</span> <span class="n">chij</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">cmpj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="nb">cmp</span><span class="p">)],</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">chi</span><span class="o">/</span><span class="n">phi</span>
<span class="n">cmpl</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">G</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">m</span><span class="o">*</span><span class="n">z</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">M</span><span class="p">])</span>
<span class="n">chil</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">G</span><span class="p">)</span><span class="o">*</span><span class="n">z</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">M</span><span class="p">])</span>
<span class="n">phil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="n">Fj</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">G</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="o">*</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">Fj</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">M</span><span class="p">)])</span>
<span class="n">wl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">Fj</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">G</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">Fj</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">M</span><span class="p">)])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">prop_cycle</span><span class="o">=</span><span class="p">(</span><span class="n">cycler</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">cycler</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">])))</span>

<span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">chi</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">z</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\chi^{(0)}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$z$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> 
           <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathcal</span><span class="si">{M}</span><span class="s1">=0.01\,(\mathcal</span><span class="si">{F}</span><span class="s1">\approx1.007)$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mathcal</span><span class="si">{M}</span><span class="s1">=0.1\,(\mathcal</span><span class="si">{F}</span><span class="s1">\approx1.06)$&#39;</span><span class="p">),</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">),</span>
           <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">cmp</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">z</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmpl</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">z</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathcal</span><span class="si">{P}</span><span class="s1">^{(0)}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(())</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">z</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phil</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">z</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(())</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\phi^{(0)}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;(c)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">z</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wl</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">z</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$w^{(0)}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(())</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;(d)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/ch12_3_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-growth-rate-of-perturbations">The growth rate of perturbations<a class="anchor-link" href="#The-growth-rate-of-perturbations"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PAR</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">S_</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Da_</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Pe_</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">M_</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">G_</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                 <span class="n">bc_</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nz_</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol_</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">plot_</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">step_</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n_</span>  <span class="c1"># permeability exponent </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">S_</span>  <span class="c1"># rigidity parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">=</span> <span class="n">Da_</span>  <span class="c1"># Damkohler number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pe</span> <span class="o">=</span> <span class="n">Pe_</span>  <span class="c1"># Peclet number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">M_</span>  <span class="c1"># solubility gradient parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">G_</span>  <span class="c1"># decompression melting parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bc_type</span> <span class="o">=</span> <span class="n">bc_</span>  <span class="c1"># boundary condition type -- 1) P(1)=0; 2) P&#39;(1)=0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nz</span> <span class="o">=</span> <span class="n">nz_</span>  <span class="c1"># number of points for eigenfunction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol_</span>  <span class="c1"># tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot_</span>  <span class="c1"># plot eigenfunction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step_</span>  <span class="c1"># stepsize in log10(k)--sigma space</span>

        
<span class="k">class</span> <span class="nc">EIG</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">p_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi</span> <span class="o">=</span> <span class="n">phi_</span>
        
<span class="k">class</span> <span class="nc">SA</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sigma_</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">m_</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">flag_</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eig</span> <span class="o">=</span> <span class="n">EIG</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag_</span>

<span class="k">class</span> <span class="nc">DC</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">k_</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">m_</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">s_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m_</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">zero_by_sigma</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">characteristic_polynomial</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">par</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">largeDa</span><span class="p">:</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">detM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">boundary_condition_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">par</span><span class="p">))</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">1.</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">detM</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">residual</span>


<span class="k">def</span> <span class="nf">zero_by_wavenumber</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">characteristic_polynomial</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">par</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">largeDa</span><span class="p">:</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">detM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">boundary_condition_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">par</span><span class="p">))</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">detM</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">residual</span>


<span class="k">def</span> <span class="nf">characteristic_polynomial</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">largeDa</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">Da</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">Pe</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">F</span> <span class="o">+</span> <span class="mf">1.0</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">Da</span>  <span class="c1"># cubic</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="o">*</span><span class="n">K</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">Da</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">S</span>  <span class="c1"># quadratic</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">S</span> <span class="o">+</span> <span class="n">sig</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">Da</span><span class="p">)</span>  <span class="c1"># linear</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">sig</span><span class="o">*</span><span class="n">K</span><span class="p">)</span>  <span class="c1"># constant</span>
    <span class="k">return</span> <span class="n">p</span>

  
<span class="k">def</span> <span class="nf">boundary_condition_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">bc_type</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>  
        <span class="c1"># C(0) = C(1) = DC(0) = 0</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mi</span><span class="p">)]</span> <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">m</span><span class="p">])</span>
        <span class="c1"># for i in [0, 1, 2]:</span>
        <span class="c1">#    M(:,i) = [1;  m(i);       exp(m(i))]</span>
    <span class="k">elif</span> <span class="n">par</span><span class="o">.</span><span class="n">bc_type</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>  
        <span class="c1"># C(0) = DC(1) = DC(0) = 0</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mi</span><span class="o">.</span> <span class="n">mi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mi</span><span class="p">)]</span> <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">m</span><span class="p">])</span>
        <span class="c1"># for i in [1, 2, 3]:</span>
        <span class="c1">#    M(:,i) = [1;  m(i);  m(i)*exp(m(i))]</span>
    <span class="k">elif</span> <span class="n">par</span><span class="o">.</span><span class="n">bc_type</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>  
        <span class="c1"># DC(1) = phi(0) + w(0) = chi(0) = 0</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">sig</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">S</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">n</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">q</span><span class="o">*</span><span class="n">mi</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">q</span><span class="o">*</span><span class="n">mi</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">mi</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">mi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mi</span><span class="p">)]</span> <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">m</span><span class="p">])</span>
        <span class="c1"># for i in [1, 2, 3]:</span>
        <span class="c1">#    M(:,i) = [q*m(i)-1; q*m(i)^2-m(i)-q*k^2; m(i)*exp(m(i))];</span>
    <span class="k">else</span><span class="p">:</span>  
        <span class="c1"># DC(1) = phi(0) = w(0) - chi(0) = 0</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">Da</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">DaPe</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">1.0</span><span class="o">-</span><span class="n">par</span><span class="o">.</span><span class="n">S</span><span class="o">*</span><span class="n">mi</span><span class="p">,</span> <span class="n">mi</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">q</span><span class="o">*</span><span class="n">mi</span><span class="p">,</span> <span class="n">mi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mi</span><span class="p">)]</span> <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">m</span><span class="p">])</span>
        <span class="c1"># for i in [1, 2, 3]:</span>
        <span class="c1">#    M(:,i) = [1-par.S*m(i); m(i)^2+q*m(i);   m(i)*exp(m(i))]</span>
    <span class="k">return</span> <span class="n">M</span>


<span class="k">def</span> <span class="nf">form_eigenfunction</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">characteristic_polynomial</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">par</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">nz</span><span class="p">)</span>
    <span class="n">eig</span> <span class="o">=</span> <span class="n">EIG</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">largeDa</span><span class="p">:</span>
        <span class="n">eig</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
        <span class="n">eig</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">eig</span><span class="o">.</span><span class="n">P</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eig</span><span class="o">.</span><span class="n">P</span><span class="p">))</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">eig</span><span class="o">.</span><span class="n">P</span>
        <span class="n">eig</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">-</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">S</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">boundary_condition_matrix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
        <span class="n">subM</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">M</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="p">(</span><span class="n">subM</span><span class="p">,</span><span class="n">b</span><span class="p">)))</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mj</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
        <span class="n">eig</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
        <span class="n">eig</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">S</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">eig</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">reactive_flow_solve_dispersion</span><span class="p">(</span><span class="n">k_guess</span><span class="p">,</span> <span class="n">sigma_guess</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="c1"># input parameters:</span>
    <span class="c1">#   k -- horizontal wavenumber (required)</span>
    <span class="c1">#   sigma_guess -- guess at the eigenvalue (optional)</span>
    <span class="c1">#   par -- parameter structure (optional)</span>

    <span class="n">sa</span> <span class="o">=</span> <span class="n">SA</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_guess</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># solving for growthrate sigma at a fixed value of wavenumber k</span>
        <span class="n">solve_for_sigma</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sa</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k_guess</span>
        <span class="k">if</span> <span class="n">sigma_guess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sigma_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># solving for wavenumber k at a fixed value of growthrate sigma</span>
        <span class="n">solve_for_sigma</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma_guess</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">F</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">par</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">par</span><span class="o">.</span><span class="n">S</span> <span class="o">*</span> <span class="n">par</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">par</span><span class="o">.</span><span class="n">G</span><span class="p">),</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

    <span class="c1">#problem.solver = &#39;fzero&#39;</span>
    <span class="c1">#problem.options = optimset(&#39;TolX&#39;, 1e-16, &#39;FunValCheck&#39;, &#39;off&#39;, &#39;Display&#39;, &#39;off&#39;)</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigma_guess</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">k_guess</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">solve_for_sigma</span><span class="p">:</span>
        <span class="c1"># solve eigenvalue problem to find growth rate of fastest-growing mode</span>
        <span class="c1"># problem.objective = @(s) zero_by_sigma(s):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigma_guess</span><span class="p">)</span>
        <span class="n">exitflag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigma_guess</span><span class="p">)</span>
        <span class="n">converged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sigma_guess</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sigma_guess</span><span class="p">)):</span>
            <span class="c1"># sigma[j], res[j], exitflag[j] = fsolve(zero_by_sigma, sigma_guess[j])</span>
            <span class="n">sigma</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">zero_by_sigma</span><span class="p">,</span> <span class="n">sigma_guess</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">converged</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">exitflag</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">par</span><span class="o">.</span><span class="n">tol</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">largeDa</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">characteristic_polynomial</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">sigma</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">par</span><span class="p">))</span>
                <span class="n">converged</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">converged</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">plot</span> <span class="ow">and</span> <span class="n">converged</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">eig</span> <span class="o">=</span> <span class="n">form_eigenfunction</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">sigma</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
                <span class="c1"># plt.plot(np.linspace(0.0, 1.0, par.nz), np.real(eig.P))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># solve eigenvalue problem to find wavenumber of mode</span>
        <span class="c1"># problem.objective = @(k) zero_by_wavenumber(k)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">k_guess</span><span class="p">)</span>
        <span class="n">exitflag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">k_guess</span><span class="p">)</span>
        <span class="n">converged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">k_guess</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_guess</span><span class="p">)):</span>
            <span class="c1"># problem.x0 = k_guess[j];</span>
            <span class="c1"># k[j], res[j], exitflag[j] = fzero(problem)</span>
            <span class="n">k</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">zero_by_wavenumber</span><span class="p">,</span> <span class="n">k_guess</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">converged</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">exitflag</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">par</span><span class="o">.</span><span class="n">tol</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">largeDa</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">characteristic_polynomial</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">SA</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">par</span><span class="p">))</span>
                <span class="n">converged</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">converged</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">plot</span> <span class="ow">and</span> <span class="n">converged</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">eig</span> <span class="o">=</span> <span class="n">form_eigenfunction</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">SA</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig</span><span class="o">.</span><span class="n">P</span><span class="p">))</span>

        <span class="c1"># [converged&#39;, exitflag&#39;, log10(abs(res&#39;))];</span>
    <span class="n">none_converged</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">converged</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># handle failure to find solution</span>
    <span class="k">if</span> <span class="n">none_converged</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FAILURE: no solution found for k=</span><span class="si">{k_guess}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">eig</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="n">solve_for_sigma</span><span class="p">:</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">converged</span><span class="p">)])</span>  <span class="c1"># TODO: check</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">converged</span><span class="p">)])</span>  <span class="c1"># TODO: check</span>

    <span class="n">SA</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">characteristic_polynomial</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">SA</span><span class="o">.</span><span class="n">sigma</span><span class="p">))</span>

    <span class="c1"># form and check eigenfunction</span>
    <span class="n">SA</span><span class="o">.</span><span class="n">eig</span> <span class="o">=</span> <span class="n">form_eigenfunction</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">SA</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">)</span>
    <span class="n">gP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">eig</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">gP</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">par</span><span class="o">.</span><span class="n">bc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># TODO: check</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FAILURE: non-monotonic eigenfunction for k=</span><span class="si">{SA.k}</span><span class="s1">, sigma=</span><span class="si">{SA.sigma}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">SA</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SUCCESS: monotonic eigenfunction for k=</span><span class="si">{SA.k}</span><span class="s1">, sigma=</span><span class="si">{SA.sigma}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">eig</span><span class="o">.</span><span class="n">P</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">SA</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">taylor_series_extension</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">init_Lks</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">xguess</span> <span class="o">=</span> <span class="n">init_Lks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yguess</span> <span class="o">=</span> <span class="n">init_Lks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">xguess</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">step</span>
        <span class="n">yguess</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">xguess</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">step</span>
        <span class="n">yguess</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">step</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]])</span>
        <span class="n">D</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">da</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">db</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">da</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">db</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">db</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">da</span> <span class="o">-</span> <span class="n">db</span><span class="p">)</span><span class="o">/</span><span class="n">D</span>
        <span class="n">xguess</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">da</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">step</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">d2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">yguess</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">da</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">step</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">d2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">step</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">xguess</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xguess</span><span class="p">):</span>
        <span class="n">xguess</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">yguess</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yguess</span><span class="p">):</span>
        <span class="n">yguess</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">xguess</span><span class="p">,</span> <span class="n">yguess</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">reactive_flow_trace_dispersion_curve</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">Lkbounds</span><span class="p">,</span> <span class="n">sbounds</span><span class="p">,</span> <span class="n">init_Lks</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Lk</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="n">fails</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mf">1e6</span><span class="p">:</span>
            <span class="n">Lk_guess</span><span class="p">,</span> <span class="n">s_guess</span> <span class="o">=</span> <span class="n">taylor_series_extension</span><span class="p">(</span><span class="n">Lk</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">init_Lks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Lk_guess</span> <span class="o">&lt;=</span> <span class="n">Lkbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">Lk_guess</span> <span class="o">&gt;=</span> <span class="n">Lkbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">s_guess</span> <span class="o">&lt;=</span> <span class="n">sbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">s_guess</span> <span class="o">&gt;=</span> <span class="n">sbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">s_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">fails</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Searching for solution at k={np.power(10, Lk_guess)}&#39;</span><span class="p">)</span>
                <span class="n">s_guess</span> <span class="o">=</span> <span class="n">s_guess</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">fails</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Searching for solution at sigma=</span><span class="si">{s_guess}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">Lk_guess</span> <span class="o">=</span> <span class="n">Lk_guess</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">SA</span> <span class="o">=</span> <span class="n">reactive_flow_solve_dispersion</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">Lk_guess</span><span class="p">),</span> <span class="n">s_guess</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">SA</span><span class="o">.</span><span class="n">flag</span><span class="p">:</span>
                <span class="c1"># found lowest mode; prepare for next iteration</span>
                <span class="n">Lk</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
                <span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">SA</span><span class="o">.</span><span class="n">sigma</span>
                <span class="n">m</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">SA</span><span class="o">.</span><span class="n">m</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fails</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># found higher mode; retry</span>
                <span class="n">fails</span> <span class="o">=</span> <span class="n">fails</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">Lk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">Lk</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">DC</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">Lk</span><span class="p">),</span> <span class="n">m</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">zoom</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">8.0</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">,</span> <span class="mf">5.2</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">par</span> <span class="o">=</span> <span class="n">PAR</span><span class="p">()</span>

<span class="n">Lkbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">400.0</span><span class="p">])</span>
<span class="n">sbounds</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">init_Lks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">5.</span><span class="p">),</span> <span class="mf">3.0</span><span class="p">])</span>

<span class="n">DC_ref</span> <span class="o">=</span> <span class="n">ReactiveFlowTraceDispersionCurve</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">Lkbounds</span><span class="p">,</span> <span class="n">sbounds</span><span class="p">,</span> <span class="n">init_Lks</span><span class="p">)</span>

<span class="n">Iref</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">s</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">s</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="n">dpar</span> <span class="o">=</span> <span class="n">par</span>
<span class="n">dpar</span><span class="o">.</span><span class="n">Da</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">DC_a</span> <span class="o">=</span> <span class="n">ReactiveFlowTraceDispersionCurve</span><span class="p">(</span><span class="n">dpar</span><span class="p">,</span><span class="n">Lkbounds</span><span class="p">,</span><span class="n">sbounds</span><span class="p">,</span><span class="n">init_Lks</span><span class="p">)</span>
<span class="n">dpar</span><span class="o">.</span><span class="n">Da</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">DC_b</span> <span class="o">=</span> <span class="n">ReactiveFlowTraceDispersionCurve</span><span class="p">(</span><span class="n">dpar</span><span class="p">,</span><span class="n">Lkbounds</span><span class="p">,</span><span class="n">sbounds</span><span class="p">,</span><span class="n">init_Lks</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DC_a</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">DC_a</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;--k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DC_b</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">DC_b</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;-.k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">DC_ref</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">Iref</span><span class="p">),</span> <span class="n">DC_ref</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">Iref</span><span class="p">),</span> <span class="s1">&#39;*k&#39;</span><span class="p">,</span> <span class="n">MarkerSize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="c1"># set(gca,&#39;xscale&#39;,&#39;log&#39;,&#39;xlim&#39;,XL,&#39;ylim&#39;,YL,&#39;xtick&#39;,10.^[0:2]);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">400.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="mf">1e0</span><span class="p">,</span> <span class="mf">1e1</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$Da=10$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$Da=100$&#39;</span><span class="p">,</span><span class="s1">&#39;$Da=1000$&#39;</span><span class="p">],</span> 
           <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">),</span> 
           <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-346c2de29d03&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> f<span class="ansi-blue-fg">.</span>set_facecolor<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;w&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> 
<span class="ansi-green-fg">----&gt; 6</span><span class="ansi-red-fg"> </span>par <span class="ansi-blue-fg">=</span> PAR<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1.0</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">100</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0.01</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1e-5</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0.01</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-intense-fg ansi-bold">      8</span> Lkbounds <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>log10<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0.1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">400.0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: __init__() takes from 1 to 12 positional arguments but 14 were given</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/ch12_10_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># plot eigenfunction</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">zoom</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">8.0</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">,</span> <span class="mf">5.2</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">SA_ref</span> <span class="o">=</span> <span class="n">ReactiveFlowSolveDispersion</span><span class="p">(</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">Iref</span><span class="p">),</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">Iref</span><span class="p">),</span><span class="n">par</span><span class="p">)</span>

<span class="n">lambda_</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">Iref</span><span class="p">)</span>
<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p">]</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">lambda_</span><span class="p">,</span><span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">),</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">))</span>
<span class="n">P</span>   <span class="o">=</span> <span class="n">repmat</span><span class="p">(</span><span class="n">SA_ref</span><span class="o">.</span><span class="n">eig</span><span class="o">.</span><span class="n">P</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">)</span><span class="o">.*</span><span class="n">exp</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">Iref</span><span class="p">)</span><span class="o">*</span><span class="n">X</span><span class="p">);</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">repmat</span><span class="p">(</span><span class="n">SA_ref</span><span class="o">.</span><span class="n">eig</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="p">)</span><span class="o">.*</span><span class="n">exp</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">DC_ref</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">Iref</span><span class="p">)</span><span class="o">*</span><span class="n">X</span><span class="p">);</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">3e-5</span><span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">nz</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">[</span><span class="n">Px</span> <span class="n">Pz</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">h</span><span class="p">);</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">F</span><span class="p">;</span> <span class="o">%</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">par</span><span class="o">.</span><span class="n">S</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">M</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">par</span><span class="o">.</span><span class="n">G</span><span class="p">))</span><span class="o">^</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">);</span>
<span class="n">U</span> <span class="o">=</span>     <span class="n">epsilon</span><span class="o">*</span><span class="n">real</span><span class="p">(</span><span class="o">-</span><span class="n">F</span><span class="o">^</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">S</span><span class="o">*</span><span class="n">Px</span><span class="p">);</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">F</span> <span class="o">+</span> <span class="n">epsilon</span><span class="o">*</span><span class="n">real</span><span class="p">(</span><span class="n">F</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">phi</span> <span class="o">-</span> <span class="n">F</span><span class="o">^</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">par</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">par</span><span class="o">.</span><span class="n">S</span><span class="o">*</span><span class="n">Pz</span><span class="p">);</span>
<span class="n">Chi</span> <span class="o">=</span> <span class="n">DC_ref</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">Iref</span><span class="p">)</span><span class="o">*</span><span class="n">phi</span> <span class="o">-</span> <span class="n">P</span><span class="p">;</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="p">))</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">)));</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span> <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">phi</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">phi</span><span class="p">)));</span>
<span class="n">Chi</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">Chi</span><span class="p">);</span> <span class="n">Chi</span> <span class="o">=</span> <span class="p">(</span><span class="n">Chi</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Chi</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">Chi</span><span class="p">))</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Chi</span><span class="p">)));</span>

<span class="n">axes</span><span class="p">(</span><span class="n">ax</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="n">imagesc</span><span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,:),</span><span class="n">Z</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">P</span><span class="p">);</span> <span class="n">axis</span> <span class="n">xy</span><span class="p">;</span> <span class="n">axis</span> <span class="n">equal</span><span class="p">;</span> <span class="n">axis</span> <span class="n">tight</span><span class="p">;</span> <span class="n">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">colormap</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="n">c</span> <span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">));</span>
<span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span>

<span class="n">nlines</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="k">lambda</span><span class="o">/</span><span class="p">(</span><span class="n">nlines</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">startx</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="k">lambda</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">nlines</span><span class="p">);</span> 
<span class="o">%</span><span class="k">startx</span> = startx([2:end-1]);
<span class="n">starty</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">startx</span><span class="p">))</span><span class="o">/</span><span class="mi">1000</span><span class="p">;</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">streamline</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">startx</span><span class="p">,</span><span class="n">starty</span><span class="p">);</span>
<span class="nb">set</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">gca</span><span class="p">,</span><span class="s1">&#39;ytick&#39;</span><span class="p">,[</span><span class="mi">0</span> <span class="mf">0.5</span> <span class="mi">1</span><span class="p">],</span><span class="s1">&#39;xtick&#39;</span><span class="p">,[</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">-</span><span class="n">eps</span><span class="p">]</span><span class="o">*</span><span class="k">lambda</span><span class="p">);</span>
<span class="nb">set</span><span class="p">(</span><span class="n">gca</span><span class="p">,</span><span class="s1">&#39;xticklabel&#39;</span><span class="p">,{</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">});</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x/\lambda^*$&#39;</span><span class="p">,</span><span class="s1">&#39;FontSize&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="s1">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s1">&#39;latex&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$z$&#39;</span><span class="p">,</span><span class="s1">&#39;FontSize&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="s1">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s1">&#39;latex&#39;</span><span class="p">)</span>
<span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.04</span><span class="p">,</span><span class="mf">0.98</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">extbf{(b)}&#39;</span><span class="p">,</span><span class="n">TE</span><span class="p">{:},</span><span class="s1">&#39;units&#39;</span><span class="p">,</span><span class="s1">&#39;normalized&#39;</span><span class="p">,</span><span class="n">FS</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;verticalalignment&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-cyan-fg">  File </span><span class="ansi-green-fg">&#34;&lt;ipython-input-9-7dc711b42bb4&gt;&#34;</span><span class="ansi-cyan-fg">, line </span><span class="ansi-green-fg">10</span>
<span class="ansi-red-fg">    [X,Z] = meshgrid(linspace(0,2*lambda_,par.nz),linspace(0,1,par.nz)&#39;);</span>
                                                                         ^
<span class="ansi-red-fg">SyntaxError</span><span class="ansi-red-fg">:</span> EOL while scanning string literal
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-large-Damkohler-number-limit">The large-Damkohler number limit<a class="anchor-link" href="#The-large-Damkohler-number-limit"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-modified-problem-and-its-analytical-solution">A modified problem and its analytical solution<a class="anchor-link" href="#A-modified-problem-and-its-analytical-solution"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Application-to-the-mantle">Application to the mantle<a class="anchor-link" href="#Application-to-the-mantle"> </a></h2>
</div>
</div>
</div>
</div>

 


    </main>
    